<Quest name="Fortify Dwarfenfroward" table_name="fortify_dwarfenfroward">
	
	<Init>
		local a = 2
	</Init>
	
	<Description>
		if (fortify_dwarfenfroward.finished) then
			return _("Quest finished")
		else
			return _("Quest description")
		end
	</Description>
	
	<NPC refname="Soren Windclaw">
		<!--
		<Topic name="fortify_dwarfenfroward" start_option="Defend Dwarfenfroward">
			<Condition>
				if (fortify_dwarfenfroward.finished ~= true and fortify_dwarfenfroward.freed ~= true) then
					return true
				else
					return false
				end
			</Condition>
			<Effect>
				insertTrigger("start_fortify_dwarfenfroward")
			</Effect>
		</Topic>
		-->
		<Topic name="scene1_dialogue">
			<Effect>
				addCameraPosition(0,get(getRole("PL"),"position"),20,40,20);
				addCameraPosition(20,get(getRole("PL"),"position"),220,60,30);
				
				-- Die Helden werden von mehreren Waechtern durch einen Gang geführt.
				-- Rechts und Links kann man aus den Keller merkwuerdige Geraeusche hoeren
				-- und Magisch anmutende Dinge sehen.
				
				speak("MAG",_("Als wenn das Theater"),1000);
				speak("WAR",_("Na klar! Wir sind"),1000);
				speak("MAG",_("Warum gebe ich mich"),1000);
				speak("PL",_("Scht! Streiten koennt"),1000);
				speak("W1",_("Wir sind da."),1000);
				
				-- Die Tuer wird geoeffnet und die Gruppe tritt in einen Art geheimen
				-- Verschwoerungsraum. Das Licht ist reduziert und roetlich. Alles deutet
				-- auf schmerzhafte Experimente hin. Auf einem erhoehten Podest steht ein
				-- hoch gewachsener Magier mit dem Ruecken zur Gruppe.
				
				speak("ANYast",_("Spuert ihr das?!! Das"),1000);
				speak("PL",_("Scht!"),1000);
				speak("W2",_("Mein Lord! Die..."),1000);
				speak("SW",_("Sehr gut. Eure Anwesenheit"),1000);
				speak("W1",_("Aber mein Lord, das sind"),1000);
				speak("SW",_("..."),1000);
				speak("W1",_("Wie ihr es wuenscht,"),1000);
				speak("W2",_("Jetzt komm schon"),1000);
				
				-- Beide Wachen verschwinden aus dem Raum.
				
				speak("MAG",_("Nette Huette!"),1000);
				speak("WAR",_("Naja, die Ecken sind"),1000);
				speak("PRIast",_("Diese Ritualgegenstaende haben"),1000);
				speak("SW",_("Ja, sie haben mich"),1000);
				speak("WAR",_("Schwierig?"),1000);
				speak("MAG",_("Pft. Ich haette große"),1000);
				speak("ANYast",_("Bei den ganzen Waschlappen"),1000);
				speak("PL",_("Die Elementarwachen koennten"),1000);
				speak("PRI*",_("Ich kenn da einen netten"),1000);
				speak("SW",_("Wuerdet ihr bitte kurz auf"),1000);
				
				-- Er haelt einen Kristall in die Luft. Die Gruppe verstummt sofort und
				-- dreht sich in Richtung des Gegenstandes.
				
				speak("ANY",_("Ist das etwa ein... ?"),1000);
				speak("SW",_("Ganz recht. Es handelt sich"),1000);
				speak("PL",_("Wie kann es sein, dass ihr"),1000);
				speak("SW",_("In der Tat die richtige Frage."),1000);
				speak("ANYast",_("MOEge ... dich"),1000);
				speak("SW",_("Vielleicht hat er dafUEr"),1000);
				speak("PL",_("Das kennen wir schon,"),1000);
				speak("ANYast",_("Was?!! Der Fluch kann von"),1000);
				speak("SW",_("Wie ihr es wünscht."),1000);
				speak("PL",_("Der Fluch des Totengottes"),1000);
				speak("WAR",_("Wenn nur die Schmerzen nicht"),1000);
				speak("MAG",_("Selbst hier musst du noch jammern."),1000);
				speak("SW",_("Ihr seid in der Tat"),1000);
				speak("MAG",_("Langsam macht er mich"),1000);
				speak("PRIast",_("Friede!"),1000);
				speak("SW",_("Das erste was ihr lernen muesst"),1000);
				speak("PL",_("Das schmeckt wie Ausbeutung."),1000);
				speak("PRI",_("Außerdem folgen Nekromanten"),1000);
				speak("ANYplus",_("Unter allen miesen Ratten,"),1000);
				speak("SW",_("Ihr verkennt ganz offensichtlich"),1000);
				
				addQuestion(_("Weiter dem Magier Patzig kommen?"));
				addAnswer(_("Yes"),"be_unkind");
				addAnswer(_("No"),"be_kind");
			</Effect>
		</Topic>
		
		<Topic name="be_unkind">
			<Effect>
				speak("PL",_("Ihr haltet euch wohl"),1000);
				speak("MAG",_("Sicherlich hat er sein Wissen"),1000);
				speak("WAR",_("Eine guenstige Gelegenheit."),1000);
				speak("SW",_("Ja, sie haben mich auch davor"),1000);
				
				-- Er beschwoert einen kleinen Feuerelementar vor sich und haelt einen
				-- weiteren Kristall in die Luft.
				
				speak("SW",_("Mit diesem Kristall werde ich"),1000);
				
				-- Die Gruppe kaempft gegen den Elementar. Es sollte ein schwerer Kampf
				-- sein, der aber schaffbar ist. Niemand stirbt, aber sobald die Chars
				-- auf 1% LE fallen, werden sie in einem Elementarkaefig gefangen, der
				-- jeden Handlungsspielraum unterbindet
				
				speak("SW",_("Das war der schwaechste Elementar,"),1000);
				
				changeTopic("end_cutscene");
			</Effect>
		</Topic>
		
		<Topic name="be_kind">
			<Effect>
				speak("PL",_("Natuerlich. Wenn unsere Freiheit"),1000);
				speak("WAR",_("Das gefaellt mir nicht."),1000);
				speak("SW",_("Nun gut. Ich muss mich jetzt"),1000);
				
				-- Jeder der Gruppe erhält 200 GM. Anschließend verlassen sie den Saal.
				local players = getPlayers();
				local i,player;
				for i,player in ipairs(players) do
					if (getPlayerPrivateVar(player,"fortify_dwarfenfroward.reward") ~= true) then
						setPlayerPrivateVar(player,"fortify_dwarfenfroward.reward",true);
						setObjectValue(player,"gold", getObjectValue(player,"gold") + 200);
					end;
				end;
				
				changeTopic("end_cutscene");
			</Effect>
		</Topic>
		
		<Topic name="end_cutscene">
			<Effect>
				setCutsceneMode(false);
			</Effect>
		</Topic>
	</NPC>
	
	
	<Region name="elCnlLobby">
		<Event trigger="create_region" once="true">
			<Effect>
				soren_windclaw = createObject("peasant", "locSorenWindclaw");
				setRefName(soren_windclaw, "Soren Windclaw");
				fortify_dwarfenfroward_tmp.guard1 = createObject("peasant", "locSorenWindclaw");
				fortify_dwarfenfroward_tmp.guard2 = createObject("peasant", "locSorenWindclaw");
				addArea("SorenWindclawArea","circle","locSorenWindclaw",5);
			</Effect>
		</Event>
		
		<Event trigger="player_moved" once="true">
			<Condition>
				return (unitIsInArea(trigger.player,"SorenWindclawArea"))
			</Condition>
			<Effect>
				-- insertTrigger("start_scene")
				createDialogue();
				addSpeaker(soren_windclaw,"SW");
				addSpeaker(fortify_dwarfenfroward_tmp.guard1,"W1");
				addSpeaker(fortify_dwarfenfroward_tmp.guard2,"W2");
				addSpeaker(trigger.player,"Player");
				addStandardSpeakers();
				setCutsceneMode(true);
				setTopicBase("Soren Windclaw");
				changeTopic("scene1_dialogue");
			</Effect>
		</Event>
		<!--
		<Event trigger="start_scene">
			<Effect>
				-- setCutsceneMode(true);
				-- addCameraPosition(1000,get(getRole("PL"),"position"),20,50,25);
				-- startTimer("scene_1",1500);
			</Effect>
		</Event>
		
		<Event trigger="scene_1">
			<Effect>
				createDialogue();
				addSpeaker(soren_windclaw,"SW");
				addSpeaker(fortify_dwarfenfroward_tmp.guard1,"W1");
				addSpeaker(fortify_dwarfenfroward_tmp.guard2,"W2");
				addSpeaker(trigger.player,"Player");
				addStandardSpeakers();
				setTopicBase("Soren Windclaw");
				changeTopic("scene1_dialogue");
			</Effect>
		</Event>
		
		<Event trigger ="command_complete" once="true">
			<Effect>
				print(trigger.command);
				setCutsceneMode(false);
			</Effect>
		</Event>
		-->
	</Region>
	
</Quest>

