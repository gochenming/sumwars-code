<Quest name="Fortify Dwarfenfroward" table_name="fortify_dwarfenfroward">
	
	<Init>
		local a = 2
	</Init>
	
	<Description>
		if (fortify_dwarfenfroward.finished) then
			return _("Quest finished")
		else
			return _("Quest description")
		end
	</Description>
	
	<NPC refname="Soren Windclaw">
		<!--
		<Topic name="fortify_dwarfenfroward" start_option="Defend Dwarfenfroward">
			<Condition>
				if (fortify_dwarfenfroward.finished ~= true and fortify_dwarfenfroward.freed ~= true) then
					return true
				else
					return false
				end
			</Condition>
			<Effect>
				insertTrigger("start_fortify_dwarfenfroward")
			</Effect>
		</Topic>
		-->
		<Topic name="scene1_dialogue">
			<Effect>
				addCameraPosition(0,get(getRole("PL"),"position"),20,40,20);
				addCameraPosition(20000,get(getRole("PL"),"position"),220,60,30);
				
				-- Die Helden werden von mehreren Waechtern durch einen Gang geführt.
				-- Rechts und Links kann man aus den Keller merkwuerdige Geraeusche hoeren
				-- und Magisch anmutende Dinge sehen.
				
				speak("MAG",_("As if that show would impress anyone..."));
				speak("WAR",_("Of course! We're at the Council of Summoners"));
				speak("WAR",_("and you're still talking big?!"),1400);
				speak("MAG",_("Why exactly was it that I put up with your company?"));
				speak("PL",_("Hush! You can argue later."));
				speak("W1",_("We're here."));
				
				-- Die Tuer wird geoeffnet und die Gruppe tritt in einen Art geheimen
				-- Verschwoerungsraum. Das Licht ist reduziert und roetlich. Alles deutet
				-- auf schmerzhafte Experimente hin. Auf einem erhoehten Podest steht ein
				-- hoch gewachsener Magier mit dem Ruecken zur Gruppe.
				
				speak("ANYast",_("Do you feel that??!"));
				speak("ANYast",_("It feels like..."));
				speak("PL",_("Quiet!"));
				speak("W2",_("My Lord! The... Branded Ones are here now."));
				speak("SW",_("Very well."));
				speak("SW",_("You're presence is no longer 	needed."));
				speak("W1",_("But my Lord, those are"));
				speak("SW",_("..."));
				speak("W1",_("As you wish. My apologies."));
				speak("W2",_("Come on, he knows what he's doing."));
				
				-- Beide Wachen verschwinden aus dem Raum.
				
				speak("MAG",_("Nice shack!"));
				speak("WAR",_("Well, the corners are a bit dirty though."));
				speak("PRIast",_("Those ritual objects have seen better times, too."));
				speak("SW",_("Yes, they warned me that you're difficult."));
				speak("WAR",_("Difficult?"));
				speak("WAR",_("You're putting in so much efford,"));
				speak("WAR",_("and everything you get is 'difficult'."));
				speak("MAG",_("Pft. I feel like flaring off the whole place."));
				speak("ANYast",_("With all those wimps here it's not really worth the efford, isn't it?"));
				speak("PL",_("The elemental guards might be a hassle..."));
				speak("PRIast",_("I know this nice little ban..."));
				speak("SW",_("Would you please take a quick look at this crystall."));
				
				-- Er haelt einen Kristall in die Luft. Die Gruppe verstummt sofort und
				-- dreht sich in Richtung des Gegenstandes.
				
				speak("ANY",_("Is that a...?"));
				speak("SW",_("Quite so."));
				speak("SW",_("It is a crystall straight from the heart of Harad's hell."));
				speak("PL",_("How is it possible that you're still alive?"));
				speak("SW",_("Indeed the right question."));
				speak("SW",_("With an answer, that could release every one of you from your suffering."));
				speak("SW",_("But before I give it to you, you have to do something for me."));
				speak("ANYast",_("May Harad curse you!"));
				speak("SW",_("Maybe he has time for that after he is done with you."));
				speak("SW",_("Until then you should remember that it is entirely in you hands"));
				speak("SW",_("how long you will be under this curse."));
				speak("SW",_("Fulfil my orders to the councils satisfaction"));
				speak("SW",_("and I have the power to release you of the claws of the deathgod."));
				speak("SW",_("If not, however..."));
				speak("PL",_("We know that one allready. Cut the speach."));
				speak("ANYast",_("What?!"));
				speak("ANYast",_("The curse can be taken from us? Why do I hear this only know?"));
				speak("SW",_("As you wish."));
				speak("SW",_("The task is pretty dangerous and you are likely to die more than once."));
				speak("PL",_("Harad's curse has to have some advantage."));
				speak("WAR",_("If only the pain wasn't so bad everytime..."));
				speak("MAG",_("Even here you have to whine."));
				speak("SW",_("You are indeed a bunch of trying people."));
				speak("MAG",_("He's beginning to make me angry."));
				speak("PRIast",_("Peace!"));
				speak("SW",_("The first thing you have to learn are obviously manners."));
				speak("SW",_("Consider it as a small bonus:"));
				speak("SW",_("Before your real assignment you will go to dwarfenfroward as backup."));
				speak("SW",_("Show the undead there who the real favourite of the deathgod is."));
				speak("PL",_("Smells like exploitation."));
				speak("PRI",_("Besides the necromancers don't follow Harad."));
				speak("ANYplus",_("This robegnome ranks pretty high among all the cheesy rats"));
				speak("ANYplus",_("for whom we pulled chestnuts out of the fire."));
				speak("SW",_("You obviously misjudge your position."));
				speak("SW",_("What do you think will happen, if your revealed in town?."));
				speak("SW",_("We know everything about your kind,"));
				speak("SW",_("and believe me, no one will be stupid enough to kill you."));
				
				addQuestion(_("Continue to be snotty?"));
				addAnswer(_("Yes"),"be_unkind_part1");
				addAnswer(_("No"),"be_kind");
			</Effect>
		</Topic>
		
		<Topic name="be_unkind_part1">
			<Effect>
				speak("PL",_("You consider yourself very mighty and clever, don't you?"));
				speak("MAG",_("Surely he has written down that knowledge of his somewhere."));
				speak("MAG",_("We can search for it after he's dead."));
				speak("WAR",_("A good opportunity, indeed."));
				speak("SW",_("Yes, they warned me about that, too."));
				
				-- Er beschwoert einen kleinen Feuerelementar vor sich und haelt einen
				-- weiteren Kristall in die Luft.
				
				speak("SW",_("I will keep an eye on you and give you orders with this crystal."));
				speak("SW",_("This simple elemental will remind you now that immortality has little meaning here."));
				
				-- Die Gruppe kaempft gegen den Elementar. Es sollte ein schwerer Kampf
				-- sein, der aber schaffbar ist. Niemand stirbt, aber sobald die Chars
				-- auf 1% LE fallen, werden sie in einem Elementarkaefig gefangen, der
				-- jeden Handlungsspielraum unterbindet
				
				jumpTopic("add_elemental");
				
				changeTopic("end_cutscene1_elemental");
			</Effect>
		</Topic>
		
		<Topic name="be_unkind_part2">
			<Effect>
				speak("SW",_("That was the weakest elemental I could possibly summon."));
				speak("SW",_("Now go. I have no time to waste."));
				speak("SW",_("The prince will marry soon and there are lots of preparations to make."));
				
				changeTopic("end_cutscene1");
			</Effect>
		</Topic>
		
		<Topic name="add_elemental">
			<Effect>
				fortify_dwarfenfroward_tmp.fire_elemental = createObject("fireElemS","locParty");
			</Effect>
		</Topic>
		
		<Topic name="end_cutscene1_elemental">
			<Effect>
				setCutsceneMode(false);
			</Effect>
		</Topic>
		
		<Topic name="be_kind">
			<Effect>
				speak("PL",_("Of course. With our freedom as the price"));
				speak("PL",_("we will do everything in our might to be successful."));
				speak("WAR",_("I don't like it."));
				speak("SW",_("Very well."));
				speak("SW",_("I must take care of the preparations for the princes wedding now."));
				speak("SW",_("There is no time for further explanations."));
				speak("SW",_("Take this crystall and some gold."));
				speak("SW",_("I will send you orders with it when the time comes."));
				
				-- Jeder der Gruppe erhält 200 GM. Anschließend verlassen sie den Saal.
				local players = getPlayers();
				local i,player;
				for i,player in ipairs(players) do
					if (getPlayerPrivateVar(player,"fortify_dwarfenfroward.reward") ~= true) then
						setPlayerPrivateVar(player,"fortify_dwarfenfroward.reward",true);
						setObjectValue(player,"gold", getObjectValue(player,"gold") + 200);
					end;
				end;
				
				changeTopic("end_cutscene1");
			</Effect>
		</Topic>
		
		<Topic name="end_cutscene1">
			<Effect>
				fortify_dwarfenfroward.scene1 = true;
				fortify_dwarfenfroward.started = true;
				setCutsceneMode(false);
			</Effect>
		</Topic>
	</NPC>
	
	
	<Region name="elCnlLobby">
		<Event trigger="create_region" once="true">
			<Effect>
				fortify_dwarfenfroward_tmp.guard1 = createObject("peasant", "locSorenWindclaw");
				fortify_dwarfenfroward_tmp.guard2 = createObject("peasant", "locSorenWindclaw");
			</Effect>
		</Event>
		
		<Event trigger="player_moved" once="true">
			<Condition>
				if (fortify_dwarfenfroward.scene1 ~= true) then
					return (unitIsInArea(trigger.player,"SorenWindclawArea"));
				else
					return false;
				end;
			</Condition>
			<Effect>
				createDialogue();
				addSpeaker(soren_windclaw,"SW");
				addSpeaker(fortify_dwarfenfroward_tmp.guard1,"W1");
				addSpeaker(fortify_dwarfenfroward_tmp.guard2,"W2");
				addSpeaker(trigger.player,"Player");
				addStandardSpeakers("elCnlLobby","locParty");
				setCutsceneMode(true);
				setTopicBase("Soren Windclaw");
				changeTopic("scene1_dialogue");
			</Effect>
		</Event>
		
		<Event trigger ="unit_die">
			<Condition>
				if (trigger.unit == fortify_dwarfenfroward_tmp.fire_elemental) then
					return true;
				else
					return false;
				end;
			</Condition>
			<Effect>
				createDialogue();
				addSpeaker(soren_windclaw,"SW");
				addSpeaker(fortify_dwarfenfroward_tmp.guard1,"W1");
				addSpeaker(fortify_dwarfenfroward_tmp.guard2,"W2");
				addSpeaker(trigger.player,"Player");
				addStandardSpeakers("elCnlLobby","locParty");
				setCutsceneMode(true);
				setTopicBase("Soren Windclaw");
				changeTopic("be_unkind_part2");
			</Effect>
		</Event>
	</Region>
	
</Quest>

