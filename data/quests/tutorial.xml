<Quest name="Tutorial" table_name="tutorial">
	
	<Init>
		tutorial.phase="intro"
		tutorial.phasenr =0;
	</Init>
	
	<Description>
		if (tutorial.finished) then
			return _("Tutorial finished")
		else
			if (tutorial.phase == "intro") then
				return _("Gib deine Waffen bei Derred ab.");
			elseif (tutorial.phase == "learnwalk") then
				return _("Folge Tolec und Derred.")
			elseif (tutorial.phase == "fightslugs") then
				return _("Töte alle Feuerschnecken in dem Gehege.");
			elseif (tutorial.phase == "findSecretDoor") then
				return _("Finde den geheimen Zugang zur Bibliothek.");
			elseif (tutorial.phase == "killlouses") then
				return _("Töte alle Abkömmlinge des Behemoth.");
			end
			return _("Quest description")
		end
	</Description>
	
	<Region name="elCnlLobby">
		<Event trigger="create_region" once="true">
			<Effect>
				if (tutorial.finished == false) then
					addArea("entryPlayerArea","circle","locEntryPlayer",5);
					addArea("dangerArea","circle","locBackroute2",4);
					addArea("locDoorArea","circle","locLibrarySecretDoor",3);
					addArea("mutantSlugsArea","rect","locBackroute3",{5,5});
					
					
					local tolecpos = "locTolec";
					local derredpos = "locDerred";
					tutorial_tmp.tolec = createObject("tolec", tolecpos);
					set(tutorial_tmp.tolec,"ai_state","inactive");
					setRefName(tutorial_tmp.tolec, "Tolec");
					
					tutorial_tmp.derred = createObject("derred", derredpos);
					set(tutorial_tmp.derred,"ai_state","inactive");
					setRefName(tutorial_tmp.derred, "Derred");
					
					if (tutorial.phase == "fightslugs") then
						groupObjectsArc({tutorial_tmp.tolec,tutorial_tmp.derred} ,"locWay2","locBehemothView",nil,30);
					end;
					if (tutorial.phase == "findSecretDoor") then
						groupObjectsArc({tutorial_tmp.tolec,tutorial_tmp.derred} ,"locSlugView","locSlugs",nil,30);
					end;
					if (tutorial.phase == "killlouses") then
						groupObjectsArc({tutorial_tmp.tolec,tutorial_tmp.derred} ,"locBackroute5","locPartyLib",nil,30);
					end;
					
					-- nur bei den Phasen intro, learnwalk, fightslugs
					if (2 >= tutorial.phasenr) then
						createMonsterGroup("tutorialSlugs","locSlugs",8);
						tutorial_tmp.slugs =0;
					end;
					
					tutorial_tmp.bguard1 = createObject("council_guard","locDoorGuardNorth");
					setRefName(tutorial_tmp.bguard1, "Wache");
					lookAt(tutorial_tmp.bguard1,getLocation("locBehemoth"));
				
					tutorial_tmp.bguard2 = createObject("council_guard","locDoorGuardWest");
					setRefName(tutorial_tmp.bguard2, "Wache");
					lookAt(tutorial_tmp.bguard2,getLocation("locBehemoth"));
					
					-- ab Phase fightslugs
					if (tutorial.phasenr > 1) then
						tutorial_tmp.behemoth = createObject("tutorialBehemoth","locBehemoth");
					end;
				
				
					local door;
					
					door = getObjectByNameRef("doorBehemothNorth");
					scriptobjectvar[door]["locked"] = true;
					door = getObjectByNameRef("doorBehemothWest");
					scriptobjectvar[door]["locked"] = true;
					
					door = getObjectByNameRef("doorScene1");
					scriptobjectvar[door]["locked"] = true;
					
					door = getObjectByNameRef("doorScene1");
					scriptobjectvar[door]["locked"] = true;
					
					if (2 > tutorial.phasenr) then
						door_toggle("doorBehemothNorth");
						door_toggle("doorBehemothWest");
					end;
					
					if (3 > tutorial.phasenr) then
						door = getObjectByNameRef("slugFarmBackdoor");
						scriptobjectvar[door]["locked"] = true;
					end;
					
					if (4 > tutorial.phasenr) then
						door = getObjectByNameRef("doorSecretLibrary");
						scriptobjectvar[door]["locked"] = true;
					end;
					
					if (tutorial.phasenr == 0) then
						door = getObjectByNameRef("doorPrison");
						scriptobjectvar[door]["locked"] = true;
					end;
					
					door = getObjectByNameRef("doorSlugFarm");
					scriptobjectvar[door]["locked"] = true;
					
					if (4 > tutorial.phasenr) then
						door = getObjectByNameRef("slugFarmFoodDoor");
						scriptobjectvar[door]["locked"] = true;
					end;
					
					if (4 == tutorial.phasenr) then
						createMonsterGroup("tutorialLouses","locLouses",6);
					end;
					
					tutorial_tmp.louses =0;
					tutorial_tmp.louse_count = 4;
				end;
				
				door = getObjectByNameRef("doorSouth");
				scriptobjectvar[door]["locked"] = true;
				
				door = getObjectByNameRef("doorKitchen");
				scriptobjectvar[door]["locked"] = true;
				
				door = getObjectByNameRef("doorDepth");
				scriptobjectvar[door]["locked"] = true;
				
				door = getObjectByNameRef("doorEast");
				scriptobjectvar[door]["locked"] = true;
				
				door = getObjectByNameRef("doorWest");
					scriptobjectvar[door]["locked"] = true;
					
				tutorial_tmp.slave1 = createObject("slave_miner","locSlave4",90);
				tutorial_tmp.slave2 = createObject("slave_miner","locSlave5",90);
				tutorial_tmp.slave3 = createObject("slave_miner","locSlave6",90);
			</Effect>
		</Event>
		
		<Event trigger="player_moved" once="true">
			<Condition>
				if (tutorial.phase == "intro") then
					return (unitIsInArea(trigger.player,"entryPlayerArea"));
				else
					return false;
				end;
			</Condition>
			<Effect>
				assembleParty("elCnlLobby","locEntryPlayer","locDerred");
				tutorial_tmp.assemble = "intro";
			</Effect>
		</Event>
		<Event trigger="party_complete" once="true">
			<Condition>
				return (tutorial_tmp.assemble == "intro");
			</Condition>
			<Effect>
				tutorial_tmp.assemble = nil;
				groupObjectsArc(getPlayers(),"locEntryPlayer","locTolec");
				tutorial.started = true;
				createDialogue();
				addAllPlayersToDialog();
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				
				local leader = getRolePlayer("leader");
				local blockedspeaker={};
				blockedspeaker[leader] = true;
				local solo = (getPlayers()[2] == nil);
				
				lookAtObject(tutorial_tmp.tolec,leader);
				lookAtObject(tutorial_tmp.derred,leader);
				playersLookAt(get(tutorial_tmp.tolec,"position"));
				
				addSpeaker(leader,"PL",true);
				speak("PL",_("*args*"),"injured3");
				-- TODO: (aufrappeln)
				speak("PL",_("Bei Harads Knochen!"),"injured2");
				speak("PL",_("Das war mindestens so schlimm wie die ersten Jahre in der Hölle! Wo bin ich hier?"),"injured");
				
				if (not solo) then
					speak("PL",_("Und wer sind die anderen müden Gestalten?"),"surprised");
				end;
				
				local warrior = getRolePlayerNonPref("warrior",blockedspeaker);
				local mage = getRolePlayerNonPref("mage",blockedspeaker);
				local archer = getRolePlayerNonPref("archer",blockedspeaker);
				local priest = getRolePlayerNonPref("priest",blockedspeaker);
				
				addSpeaker(warrior,"warrior",true);
				addSpeaker(mage,"mage",true);
				addSpeaker(archer,"archer",true);
				addSpeaker(priest,"priest",true);
				
				if (warrior ~= leader) then
					speak("warrior",_("Suchst du Streit? Wer ist für diesen Schlammassel verantwortlich!?!"),"angry");
				end;
				-- TODO:  (blickt sich um)
				
				speak("warrior",_("Beinahe hätte ich den verdammten Oger gehabt und plötzlich reißt mir jemand die Eingeweide raus, der noch nicht mal in meiner Nähe steht!"),"offended");
				
				if (warrior ~=0 and mage ~= 0 ) then
					speak("mage",_("Ah ja! Die Wunder geistigen Kapazität von Knüppelschwingern."),"sneer");
					speak("warrior",_("Ich zeig dir gleich die Ausdauerkapazitäten von Magiesprutzern!"),"threaten");
				end;
				
				speak("mage",_("Welch abstoßendes Ambiente. Ich habe nicht darum gebeten, hier zu sein... ich hatte gerade einen so ansprechenden und sicheren Ort gefunden."),"normal");
				
				speak("Tolec",_("Entschuldigt..."),"thoughtful");
				speak("Derred",_("Nein, du musst das viel bestimmter sagen."),"angry");
				
				if (priest ~= 0) then
					executeInDialog('lookAt('..priest..',getLocation("locEvilMachine"))');
				end;
				
				speak("priest",_("Es scheint, als besäße hier jemand größeres Wissen über die Art und Weise, wie Harad uns am Leben hält und bewegt."), "thoughtful");
				speak("archer",_("Wer auch immer hier das Sagen hat: Er hat sich besser überlegt, worauf er sich einlässt."),"threaten");
				speak("archer",_("Viel Geld könnte mich wieder gnädig stimmen."),"grin");
				
				speak("Tolec",_("Bitte entschuldigt die etwas raue Ankunft. Lord Magister Soren Windklaue erbittet eure Audienz."),"unhappy")
				
				local magopt = getRolePlayerPref("all",mage);
				local waropt = getRolePlayerPref("all",warrior);
				local arcopt = getRolePlayerPref("all",archer);
				addSpeaker(magopt,"magopt");
				addSpeaker(waropt,"waropt");
				addSpeaker(arcopt,"arcopt");
				
				speak("magopt",_("Ach so!"),"excited");
				speak("magopt",_("Lord"),"grin");
				speak("magopt",_("Magister"),"grin");
				speak("magopt",_("Windklaue."),"grin");
				speak("magopt",_("Warum habt ihr das nicht gleich gesagt?"),"bored");
				speak("Derred",_("Nun, wenn Ihr uns bitte folgen würdet?"),"happy");
				if (not solo) then
					speak("waropt",_("Wollt ihr uns verarschen? Wer bitte schön ist denn dieser Windwichtel?"),"warcry");
				else
					speak("PL",_("Wollt ihr mich verarschen? Wer bitte schön ist denn dieser Windwichtel?"),"warcry");
				end;
				
				if (mage ~= waropt) then
					speak("mage",_("Eine brillante Frage. Kurz und Präzise. Vielleicht kann man doch mit ihm arbeiten."),"thoughtful");
				end;
				
				speak("Derred",_("Ähm..."),"fear");
				if (priest ~= waropt) then
					speak("priest",_("Nur die Ruhe, mein Sohn. Nimm dir Zeit, über die Antwort nachzudenken."),"normal");
					
					if (priest ~= 0) then
						blockedspeaker={};
						blockedspeaker[priest] = true;
						local any1 = getRolePlayer("all",priest);
						addSpeaker(any1,"any1",true);
						speak("any1",_("Es könnte deine Letzte sein."),"threaten");
					end;
				end;
				
				executeInDialog("addUnitCommand("..leader..",'walk',tutorial_tmp.derred,3)");
				speak("PL",_("Raus damit. Wo sind wir und wer hat den Nerv, Gezeichnete gegen sich auf zu bringen?!"),"threaten");
				speak("Tolec",_("Nun, der Lord Magister hat versichert, dass er Euch das alles genau erklären wird."),"aloof");
				speak("Derred",_("Außerdem war Eure Ankunft... etwas beschwerlich. Ihr dürftet im Moment nicht einmal in der Lage sein, uns gefährlich zu werden."),"amused");
				speak("waropt",_("Was habt ihr getan ihr Bastarde?!"),"angry");
				speak("Tolec",_("Keine Angst, wir haben strikten Befehl, euch nicht zu töten."),"sneer");
				
				speak("arcopt",_("Der Kerl scheint zu wissen, was er tut."),"sad");
				if (arcopt ~= leader) then
					speak("PL",_("Das ist nicht der richtige Zeitpunkt, um beeindruckt zu sein."),"normal");
				end;
				
				speak("Derred",_("Schön. Da das geklärt ist, möchte ich Euch bitten, mir eure Ausrüstung zu überlassen."),"allof");
				speak("Tolec",_("Freundlich bitten."),"happy");
				speak("Derred",_("Wir können kein Risiko eingehen und innerhalb der Konzils seid Ihr sicher."),"normal");
				speak("arcopt",_("Konzil? Das Konzil der Elementarbeschwörer?! Ist das hier Aisen?"),"surprised");
				speak("Tolec",_("Ja, aber das tut jetzt nichts zur Sache!"),"angry");
				if ( not solo) then
					speak("PL",_("Was wenn wir gar keine Lust haben unsere Waffen ab zu geben?"),"surprised");
				else
					speak("PL",_("Was wenn ich gar keine Lust habe meine Waffen ab zu geben?"),"surprised");
				end;
				
				speak("Tolec",_("Es tut uns leid, wir können euch nicht vorher aus dem Sicherheitsbereich lassen."),"aloof");
				speak("magopt",_("Sicherheitsbereich?! Das ist ein verdammtes Gefängnis!"),"unhappy");
				speak("Derred",_("Es ist eure Entscheidung"),"bored");
				
				setTopicBase("Derred");
				changeTopic("give_weapons");
			</Effect>	
		</Event>
	</Region>

	<NPC refname="Derred">
		<Topic name="give_weapons" start_option="Waffen abgeben">
			<Condition>
				return (tutorial.phase == "intro")
			</Condition>
			<Effect>
				addAllPlayersToDialog();
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				
				addQuestion("Wollt ihr die Waffen abgeben?");
				addAnswer("Ja","give_weapons_yes");
				addAnswer("Nein","give_weapons_no");
			</Effect>
		</Topic>
		
		<Topic name="give_weapons_yes">
			<Effect>
				local warrior = getRolePlayer("warrior");
				local waropt = getRolePlayerPref("all",warrior);
				local solo = (getPlayers()[2] == nil);
				addSpeaker(waropt,"waropt");
				if (not solo) then
					speak("waropt",_("Wie es aussieht haben wir keine Wahl..."),"unhappy");
				else
					speak("waropt",_("Wie es aussieht habe ich keine Wahl..."),"unhappy");
				end;
				executeInDialog("startTimer('remove_weapons',1000)");
				speakPause(2000);
				speak("Derred",_("Sehr Gut. Folgt mir bitte."),"normal");
				executeInDialog("insertTrigger('start_learnwalk')");
			</Effect>
		</Topic>
		
		<Topic name="give_weapons_no">
			<Effect>
				speak("PL",_("Vergesst es!"),"angry");
				speak("Tolec",_("Wir ihr es wünscht, aber dieser Raum ist sicher. Ihr werdet ihn nicht verlassen, wenn ihr nicht eure Waffen abgebt."),"aloof");
				speak("Derred",_("Sagt einfach bescheid, indem ihr einen von uns anklickt, wenn ihr es euch anders überlegt habt."),"bored");
				setSpeakerEmotion("Tolec","excited");
				setSpeakerEmotion("Derred","excited");
				speakPause(1000);
			</Effect>
		</Topic>
	</NPC>
	
	<NPC refname="Tolec">
		<Topic name="give_weapons_t" start_option="Waffen abgeben">
			<Condition>
				return (tutorial.phase == "intro")
			</Condition>
			<Effect>
				setTopicBase("Derred");
				changeTopic("give_weapons");
			</Effect>
		</Topic>	
	</NPC>
	
	<Region name="elCnlLobby">
	
		<Event trigger="remove_weapons" once="true">
			<Effect>
				local players = getPlayers();
				local i,player;
				for i,player in ipairs(players) do
					if (getPlayerPrivateVar(player,"tutorial.phase") == "intro") then
						removePlayerItem(player, getInventoryPosition(player,"weapon"));
						local weapontype = getItemValue("subtype");
						setPlayerPrivateVar(player,"tutorial.weapon", weapontype);
						deleteItem();
					end;
				end;
				
				tutorial.phase="learnwalk"
				tutorial.phasenr =1;
			</Effect>	
		</Event>
		
		<Event trigger="player_moved" once="true">
			<Condition>
				if (tutorial.phase == "learnwalk" and tutorial_tmp.learnwalkstarted ~= true) then
					return (unitIsInArea(trigger.player,"entryPlayerArea"));
				else
					return false;
				end;
			</Condition>
			<Effect>
				insertTrigger("start_learnwalk");
				unitSpeak(tutorial_tmp.derred,_("Folgt mir bitte."));
			</Effect>	
		</Event>
		
		<Event trigger="start_learnwalk" once="true">
			<Effect>
				door_toggle("doorPrison");
				addUnitCommand(tutorial_tmp.tolec,"walk","locWay1",1);
				addUnitCommand(tutorial_tmp.derred,"walk","locWay1",1);
				tutorial_tmp.learnwalkstarted = true;
				tutorial_tmp.tolecway1 = true;
			</Effect>	
		</Event>
		
		<Event trigger="command_complete">
			<Condition>
				return (trigger.unit == tutorial_tmp.tolec 
				and tutorial.phase == "learnwalk"
				and tutorial_tmp.tolecway1 == true);
			</Condition>	
			<Effect>
				startTimer("check_walk_success",15000);
			</Effect>	
		</Event>
		
		<Event trigger="check_walk_success">
			<Condition>
				return (tutorial_tmp.walk_success ~= true);
			</Condition>
			<Effect>
				tutorial_tmp.tolecway1 = false;
				addUnitCommand(tutorial_tmp.tolec,"walk","locDerred");
			</Effect>	
		</Event>
		
		<Event trigger="command_complete">
			<Condition>
				return (trigger.unit == tutorial_tmp.tolec 
				and tutorial.phase == "learnwalk"
				and tutorial_tmp.tolecway1 == false);
			</Condition>	
			<Effect>
				unitSpeak(tutorial_tmp.tolec,_("Wo bleibt Ihr denn? Hat Euch der Transport so sehr zugesetzt, dass ihr nicht mal mehr wisst, wie man sich bewegt? Klickt einfach mit der linken Maustaste auf eine Stelle auf dem Boden, dann kommt das alles von ganz allein wieder."),"unhappy");
				startTimer("tolec_back_way1",2000);
			</Effect>
		</Event>
		
		<Event trigger="tolec_back_way1">
			<Effect>
				tutorial_tmp.tolecway1 = true;
				addUnitCommand(tutorial_tmp.tolec,"walk","locWay1");
			</Effect>	
		</Event>
		
		
		<Event trigger="player_moved" once="true">
			<Condition>
				if (tutorial.phase == "learnwalk") then
					return (unitIsInArea(trigger.player,"waypoint1Area"));
				else
					return false;
				end;
			</Condition>
			<Effect>
				tutorial_tmp.walk_success = true;
				if (tutorial_tmp.tolecway1 == false) then
					clearUnitCommands(tutorial_tmp.tolec);
					addUnitCommand(tutorial_tmp.tolec,"walk","locWay1");
				end;
				addUnitCommand(tutorial_tmp.tolec,"walk","locWay2");
				addUnitCommand(tutorial_tmp.derred,"walk","locWay2");
			</Effect>
		</Event>
		
		<Event trigger="player_moved" once="true">
			<Condition>
				if (tutorial.phase == "learnwalk") then
					return (unitIsInArea(trigger.player,"waypoint2Area"));
				else
					return false;
				end;
			</Condition>
			<Effect>
				insertTrigger("behemoth_start");
			</Effect>
		</Event>
		
		
		<Event trigger="behemoth_start" once="true">
			<Effect>
				setCutsceneMode(true);
				moveObject(tutorial_tmp.tolec,"locWay2");
				moveObject(tutorial_tmp.derred,"locWay2");
				addUnitCommand(tutorial_tmp.tolec,"walk","locBehemothDoorEast",1);
				addUnitCommand(tutorial_tmp.derred,"walk","locBehemothDoorEast",1);
				
				tutorial_tmp.worker = createObject("slave_worker","locWorker");
				setRefName(tutorial_tmp.worker, "Arbeiter");
				set(tutorial_tmp.worker,"angle",90);
				
				tutorial_tmp.worker2 = createObject("slave_worker","locWorker2");
				setRefName(tutorial_tmp.worker2, "Arbeiter");
				
				tutorial_tmp.behemoth = createObject("tutorialBehemoth","locBehemothStart");
				lookAtObject(tutorial_tmp.behemoth,tutorial_tmp.worker);
				
				addCameraPosition(0,"locBehemothStart" , 90,20, 30);
				startTimer("behemoth_attack1",2000);
			</Effect>
		</Event>
		
		<Event trigger="behemoth_attack1" once="true">
			<Effect>
				addUnitCommand(tutorial_tmp.behemoth,"behemoth_fire_storm",tutorial_tmp.worker);
			</Effect>
		</Event>
		
		<Event trigger="unit_hit" once="true">
			<Condition>
				return (trigger.defender == tutorial_tmp.worker);
			</Condition>
			<Effect>
				unitSpeak(tutorial_tmp.worker,_("*Argh!!!*"),"injured3");
				set(tutorial_tmp.worker,"health",0);
				
				startTimer("behemoth_attack2",1000);
			</Effect>
		</Event>
		
		
		<Event trigger="behemoth_attack2" once="true">
			<Effect>
				addUnitCommand(tutorial_tmp.behemoth,"behemoth_fire_storm",tutorial_tmp.worker2);
				startTimer("destroy_bprison",1500);
				startTimer("behemoth_attack3",2000);
			</Effect>
		</Event>
		
		<Event trigger="destroy_bprison" once="true">
			<Effect>
				deleteObject(getObjectByNameRef("behemothPrison"));
				deleteObject(getObjectByNameRef("workerScaffolding"));
			</Effect>
		</Event>
		
		<Event trigger="behemoth_attack3" once="true">
			<Effect>
				addUnitCommand(tutorial_tmp.behemoth,"hammer_bash",tutorial_tmp.worker2);
				addUnitCommand(tutorial_tmp.behemoth,"walk","locBehemoth");
			</Effect>
		</Event>
		
		<Event trigger="unit_hit" once="true">
			<Condition>
				return (trigger.defender == tutorial_tmp.worker2);
			</Condition>	
			<Effect>
				set(tutorial_tmp.worker2,"health",0);
				startTimer("closeBehemothDoor1",2000);
			</Effect>	
		</Event>
		
		<Event trigger="closeBehemothDoor1" once="true">
			<Effect>
				addCameraPosition(500, "locDoorGuardWest" , 0,30, 20);
				unitSpeak(tutorial_tmp.bguard2,_("Bei Akeran! Verschließt die Tore!!!"),"fear");
				timedExecute("door_toggle('doorBehemothWest')",1500);
				startTimer("closeBehemothDoor2",3000);
			</Effect>
		</Event>
		
		<Event trigger="closeBehemothDoor2" once="true">
			<Effect>
				addCameraPosition(500, "locDoorGuardNorth" , -90,30, 20);
				timedExecute("door_toggle('doorBehemothNorth')",1500);
				startTimer("tolec_flee",3000);
			</Effect>
		</Event>
		
		<Event trigger="tolec_flee" once="true">
			<Effect>
				addCameraPosition(500, "locBehemothDoorEast" , -90,70, 20);
				addUnitCommand(tutorial_tmp.tolec,"walk","locWay2",1);
				addUnitCommand(tutorial_tmp.derred,"walk","locWay2",1);
				unitSpeak(tutorial_tmp.tolec,_("Akerans Schild! Das DING ist frei! Alle zurück! Los, los, los!"),"fear");
				startTimer("explain_fight",3000);
			</Effect>
		</Event>
		
		<Event trigger="explain_fight" once="true">
			<Effect>
				setCutsceneMode(false);
				assembleParty("elCnlLobby","locWay2");
				tutorial_tmp.assemble = "explain_fight";
			</Effect>
		</Event>
		<Event trigger="party_complete" once="true">
			<Condition>
				return (tutorial_tmp.assemble == "explain_fight");
			</Condition>
			<Effect>
				tutorial_tmp.assemble = nil;
				groupObjectsArc(getPlayers(),"locBehemothView","locWay2");
				moveObject(tutorial_tmp.tolec,"locWay2");
				moveObject(tutorial_tmp.derred, "locWay2");
				
				createDialogue();
				addAllPlayersToDialog();
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				groupObjectsArc({tutorial_tmp.tolec,tutorial_tmp.derred} ,"locWay2","locBehemothView",nil,30);
				
				local solo = (getPlayers()[2] == nil);
				addStandardRoles();
				
				local leader = getSpeaker("PL");
				local waropt = getSpeaker("waropt");
				local mage = getSpeaker("mage");
				
				lookAtObject(tutorial_tmp.tolec,leader);
				lookAtObject(tutorial_tmp.derred,leader);
				playersLookAt(get(tutorial_tmp.tolec,"position"));
				
				speak("Derred",_("Da kommen wir nicht vorbei. Was machen wir jetzt?"),"unhappy");
				speak("PL",_("Ist das Ding da echt so schlimm?"),"sneer");
				speak("Derred",_("Habt ihr keine Augen im Kopf? Das Teil ist riesig!"),"offendend");
				speak("waropt",_("Größe ist nicht alles."),"grin");
				speak("arcopt",_("Sieht für mich aus wie die Fahrkarte nach draußen. Kann nicht schmerzhafter sein als die Ankunft."),"happy");
				speak("Tolec",_("Äh ja... deswegen..."),"thoughtful");
				speak("priopt",_("Was?"),"threaten");
				speak("Tolec",_("Der Lord Magister Windklaue befürchtete, Ihr könntet Euch nach eurem Eintreffen selbst entleiben, um wieder zu verschwinden, deswegen hat er... Maßnahmen getroffen"),"aloof");
				
				executeInDialog("addUnitCommand("..waropt..",'walk',tutorial_tmp.tolec)");
				speak("waropt",_("Maßnahmen?"),"threaten");
				speak("Derred",_("Nun, wir verstehen nicht viel davon, aber anscheinend sterbt Ihr nicht, sondern könnt einfach, wo Ihr wollt wiederauferstehen, nachdem euer Körper zerstört wurde."),"thoughtful");
				speak("Tolec",_("Akeran muss euch wirklich hassen..."),"grin");
				if (not solo) then
					speak("priopt",_("Und? Niemand von uns hat um diese Fähigkeit gebeten."),"threaten");
				else
					speak("priopt",_("Und? Ich habe nicht um diese Fähigkeit gebeten."),"threaten");
				end;
				
				speak("Derred",_("Nun, in eurem jetzigen Zustand könnt ihr das nur an Orten großer magischer Konzentration, die ihr bereits besucht habt. Mit anderen Worten..."),"amused");
				speak("waropt",_("...nur dahinten bei dem ganzen Krempel."),"thoughtful");
				if (mage ~= waropt and waropt ~= 0) then
					speak("mage",_("Krempel würde ich das nicht unbedingt nennen."),"sad")
				end;
				
				speak("Tolec",_("Genau, nur an dieser Stelle."),"surprised");
				if (not solo) then
					speak("PL",_("Es wird Zeit, dass wir mit diesem Windklaue reden. Scheint ja ein gewitztes Kerlchen zu sein."),"unhappy");
				else
					speak("PL",_("Es wird Zeit, dass ich mit diesem Windklaue rede. Scheint ja ein gewitztes Kerlchen zu sein."),"unhappy");
				end;
				speak("arcopt",_("Ist sicher nicht allzu gesund so gewitzt zu sein."),"sneer");
				speak("Derred",_("Äh, ja, gut. Da der Weg nach vorne momentan versperrt ist, müssen wir wohl versuchen, durch das Gehege mit den neuen Experimenten zu kommen."),"unhappy")
				speak("Derred",_("Es gibt da eine Hintertür für die Fütterung und angeblich..."));
				speak("Tolec",_("...hat sich der alte Feuerwirbel eine Geheimtür als Direktverbindung zur Küche eingebaut. Das könnte klappen! Aber die Viecher sind nicht ungefährlich."),"surprised");
				speak("Derred",_("Das sind doch nur diese Schnecklinge."),"sneer");
				speak("Tolec",_("Na, ich weiß ja nicht... ich hab keine Lust, nur wegen so einem schleimigen Feueratem drei Wochen das Bett zu hüten."),"disgust");
				
				if (not solo) then
					speak("priopt", _("Bei Harad! Das kann man sich ja unmöglich antun. Gebt uns unsere Waffen und wir kümmern uns darum."),"unhappy");
				else
					speak("priopt", _("Bei Harad! Das kann man sich ja unmöglich antun. Gib mir meine  Waffe und ich kümmere mich darum."),"thoughtful");
				end;
				speak("Derred",_("Nun, da habt Ihr nicht unrecht..."),"thoughtful");
				speak("Tolec",_("Ja, in Anbetracht der schwierigen Umstände können wir das wohl machen. Hier bittesehr."),"thoughtful");
				
				executeInDialog("insertTrigger('give_back_weapons')");
				
				speak("waropt",_("Was soll das denn sein?"),"surprised")
				speak("waropt",_("Wo ist meine Waffe?"),"warcry");
				
				speak("Tolec",_("Ähm... Lord Magister Windklaue befürchtete, dass es zu einer Situation kommen könnte, in der ihr auf, äh, Waffengewalt zurückgreifen müsst. Deswegen hat er uns diese hier mitgegeben."),"aloof");
				speak("Derred",_("Ihr versteht sicherlich, dass ihr hier nicht mit ungeprüften Waffen umherlaufen könnt."),"aloof");
				
				speak("waropt",_("Langsam fangt ihr an zu nerven."),"threaten");
				speak("arcopt",_("Woran hat der eigentlich nicht gedacht? Der ist doch eindeutig paranoid."),"unhappy");
				
				speak("Derred",_("Ihr... könnt euch noch erinnern, wie man eine Waffe benutzt richtig? Uns wurde gesagt, dass die ersten Minuten sind, als träte man zum ersten Mal in die Welt."),"aloof");
				
				tutorial.phase = "fightslugs";
				tutorial.phasenr = 2;
				
				setTopicBase("Derred");
				addQuestion(_("Inventar erklären?"));
				addAnswer("Ja","explain_inventory");
				addAnswer("Nein","explain_inv_no");
			</Effect>
		</Event>
		
		<Event trigger="give_back_weapons" once="true">
			<Effect>
				local players = getPlayers();
				local i,player;
				for i,player in ipairs(players) do
					if (getPlayerPrivateVar(player,"tutorial.weapon") ~= nil ) then
						createItem(getPlayerPrivateVar(player,"tutorial.weapon"))
						setPlayerPrivateVar(player,"tutorial.weapon",nil) 
						
						insertPlayerItem(player,false);
					end;
				end;
			</Effect>
		</Event>
	</Region>
	
	<NPC refname="Derred">
		<Topic name="explain_inventory" start_option="Inventar erklären">
			<Condition>
				return (tutorial.phase == "fightslugs" and tutorial_tmp.slugdoor_open ~= true)
			</Condition>
			<Effect>
				speak("Derred",_("Zuerst müsst Ihr euer Inventar öffnen. Dies tut ihr standardmäßig mit der 'i'-Taste."),"normal");
				speak("Derred",_("Alternativ könnt ihr auch auf den Inventarknopf unten in der Statusleiste drücken."));
				speak("Derred",_("Im Inventar seht ihr dann Eure Gegenstände. Sie sind unterteilt nach ihrer Größe."));
				speak("Derred",_("Die Waffe, die Ihr gerade 	erhalten habt ist ein mittelgroßer Gegenstand und befindet sich deshalb im mittleren Feld"));
				speak("Derred",_("Klickt die Waffe mit der linken Maustaste an und klickt danach auf das Waffenfeld in Eurer Ausrüstung über dem Inventar. Und schon habt ihr sie angelegt."));
				changeTopic("explain_inv_no");
			</Effect>
		</Topic>
		<Topic name="explain_inv_no">
			<Effect>
				speak("Derred",_("Sagt Bescheid, sobald ihr bereit seid"));
			</Effect>
		</Topic>
		
		<Topic name="attack_slugs" start_option="Schnecken angreifen">
			<Condition>
				return (tutorial.phase == "fightslugs" and tutorial_tmp.slugdoor_open ~= true)
			</Condition>
			<Effect>
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				setTopicBase("Tolec");
				changeTopic("attack_slugs");
			</Effect>
		</Topic>		
	</NPC>
	
	<NPC refname="Tolec">
		<Topic name="explain_inventory" start_option="Inventar erklären">
			<Condition>
				return (tutorial.phase == "fightslugs" and tutorial_tmp.slugdoor_open ~= true)
			</Condition>
			<Effect>
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				setTopicBase("Derred");
				changeTopic("explain_inventory");
			</Effect>
		</Topic>
		
		<Topic name="attack_slugs" start_option="Schnecken angreifen">
			<Condition>
				return (tutorial.phase == "fightslugs" and tutorial_tmp.slugdoor_open ~= true)
			</Condition>
			<Effect>
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				addStandardRoles();
				addAllPlayersToDialog();
				local solo = (getPlayers()[2] == nil);
				
				local players = getPlayers();
				local i,player;
				local allequip = true;
				for i,player in ipairs(players) do
					if (getPlayerPrivateVar(player,"tutorial.phase") == "fightslugs" ) then
						getPlayerItem(player,getInventoryPosition(player,"weapon"));
						if (getItemValue("type") == "noitem") then
							allequip = false;
						end;
					end;
				end;
				
				if (allequip == false) then
					if (solo) then
						speak("Tolec",_("Ihr solltet zunächst eure Waffen anlegen."));
					else
						speak("Tolec",_("Ihr solltet alle zunächst eure Waffen anlegen."));
					end;
					return;
				end
				
				speak("Tolec",_("Aber wir ihr kämpft wisst ihr doch noch, oder?"),"surprised");
				speak("PL",_("Reingehen, anklicken, töten. Das vergisst man niemals als Gezeichneter."),"bored");
				speak("Derred",_("Anklicken?"),"surprised");
				speak("Tolec",_("Keine Ahnung, der Lord Magister hat gesagt, die verstehen das schon."),"thoughtful");
				speak("waropt",_("Lasst uns diese Experimente das Fürchten lehren!"),"excited");
				speak("arcopt",_("Ich hoffe, die haben auch eine Seele."),"thoughtful")
				if (getSpeaker("priopt") ~= getSpeaker("arcopt")) then
				speak("priopt",_("Keine Sorge. Selbst ein Golem hat eine. Da werden die Dinger keine Ausnahme sein."),"happy");
				end;
				speak("Tolec",_("Sehr gut, haltet uns einfach diese Dinger vom Hals, während wir versuchen die Luke zu  öffnen."),"happy");
				speak("Derred",_("Ich geh da nicht rein, wenn die Viecher noch auf freiem Fuß sind!"),"disgust");
				
				executeInDialog("startTimer('open_slugdoor',1500)");
				local door = getObjectByNameRef("slugFarmBackdoor");
				executeInDialog("addUnitCommand(tutorial_tmp.tolec,'walk',"..door..",2)");
				tutorial_tmp.slug_door_pos = get(door,"position");
			</Effect>
		</Topic>
	</NPC>
	
	<Region name="elCnlLobby">
		<Event trigger="open_slugdoor" once="true">
			<Effect>
				door_toggle("slugFarmBackdoor");
				clearUnitCommands(tutorial_tmp.tolec);
				tutorial_tmp.slugdoor_open = true;
			</Effect>
		</Event>
		
		<Event trigger="unit_dead">
			<Condition>
				return (tutorial.phase == "fightslugs" and get(trigger.unit,"subtype") == "fireSlug")
			</Condition>
			<Effect>
				tutorial_tmp.slugs = tutorial_tmp.slugs +1;
				if (tutorial_tmp.slugs == 10) then
					addUnitCommand(tutorial_tmp.tolec,'walk',tutorial_tmp.slug_door_pos,1);
					addUnitCommand(tutorial_tmp.derred,'walk',tutorial_tmp.slug_door_pos,1);
					addUnitCommand(tutorial_tmp.tolec,'walk',"locSlugView",2);
					addUnitCommand(tutorial_tmp.derred,'walk',"locSlugView",2);
				end
			</Effect>
		</Event>
		
		<Event trigger="command_complete" once="true">
			<Condition>
				return (tutorial.phase == "fightslugs" and tutorial_tmp.slugs == 10 and trigger.unit == tutorial_tmp.tolec and trigger.last_command)
			</Condition>
			<Effect>
				assembleParty("elCnlLobby","locSlugs");
				tutorial_tmp.assemble = "fightslugs";
			</Effect>
		</Event>
		<Event trigger="party_complete" once="true">
			<Condition>
				return (tutorial_tmp.assemble == "fightslugs");
			</Condition>
			<Effect>
				tutorial_tmp.assemble = nil;
				groupObjectsArc(getPlayers(),"locSlugs","locSlugView");
				moveObject(tutorial_tmp.tolec,"locSlugView");
				moveObject(tutorial_tmp.derred, "locSlugView");
				groupObjectsArc({tutorial_tmp.tolec,tutorial_tmp.derred} ,"locSlugView","locSlugs",nil,30);
				
				createDialogue();
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addStandardRoles();
				addAllPlayersToDialog();
				
				local leader = getRolePlayer("leader");
				lookAtObject(tutorial_tmp.tolec,leader);
				lookAtObject(tutorial_tmp.derred,leader);
				playersLookAt(get(tutorial_tmp.tolec,"position"));
				
				speak("Derred",_("Ihh, die Dinger sind echt widerlich"),"digust");
				speak("any",_("Was seid ihr denn für Mimosen?"),"sneer");
				speak("Derred",_("Suchst du streit, du Schwächling?!"),"threaten");
				speak("Tolec",_("Warte mal, irgendwie sind sie stärker geworden."),"thoughtful");
				speak("leader",_("Euer Hexenkram mag uns ja geschwächt haben, aber mit jeden getöteten Wesen nehmen wir einen Teil seiner Kraft auf und werden stärker."),"excited");
				speak("any",_("Überleg dir also lieber, wen du hier Schwächling nennst!"),"grin");
				speak("Tolec",_("Hm, stimmt der Lord Magister hat gesagt, das so etwas passieren kann. Wisst ihr auch, wie ihr diese Kraft in vernünftige Fähigkeiten umwandelt?"),"thoughtful");
				
				tutorial_tmp.behemoth_show = true;
				tutorial.phase = "findSecretDoor";
				tutorial.phasenr = 3;
				
				setTopicBase("Tolec");
				addQuestion("Levelup erklären?");
				addAnswer("Ja","explain_levelup");
				addAnswer("Nein","explain_levelup_continue");
				
			</Effect>
		</Event>
	</Region>
	
	<NPC refname="Tolec">
		<Topic name="explain_levelup" start_option="Levelup erklären">
			<Condition>
				return (tutorial.phase == "findSecretDoor" and tutorial_tmp.fooddoor_open ~= true)
			</Condition>
			<Effect>
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				if (getSpeaker("priopt") == 0) then
					addSpeaker(getSpeaker("player"),"priopt");
				end;
				speak("Tolec",_("Ihr könnt jedes Mal eure Attribute verbessern und von Zeit zu Zeit habt ihr sogar genug Energie für eine neue Fähigkeit."),"normal");
				speak("Derred",_("Ja genau, das war doch das, mit dem großen Plus in der linken unteren Ecke. Klickt einfach darauf und verteilt dann im Attributfenster oben eure Attribut Punkte."),"normal");
				speak("Tolec",_("Genau, und den Fähigkeitenpunkt könnt ihr im Fähigkeitenfenster verteilen. Der Lord Magister hat gesagt, dass ihr die aus drei verschiedenen Kategorien wählen könnt."));
				speak("Derred",_("In Abhängigkeit von eurer... Charaktermasse"),"thoughtful");
				speak("Tolec",_("Charakterklasse."),"unhappy");
				speak("Derred",_("Oh, genau!"),"surprised");
				
				speak("priopt",_("Ich frage mich, woher dieser Soren so viel über die Gefallenen weiß..."),"thoughtful");
				speak("warrior",_("Magier sind äußerst merkwürdig. Alle."),"unhappy");
				if (getSpeaker("warrior") ~= 0) then
					speak("mage",_("Besser merkwürdig als..."),"sneer");
				end;
				if (tutorial_tmp.behemoth_show) then
					changeTopic("explain_levelup_continue");
				end;
			</Effect>
		</Topic>
		<Topic name="explain_levelup_continue" >
			<Effect>
				insertTrigger("behemoth_show2");
			</Effect>
		</Topic>	
	</NPC>
	
	<Region name="elCnlLobby">
		<Event trigger="behemoth_show2" once="true">
			<Effect>
				startTimer("behemoth_show_end",6000);
				setCutsceneMode(true);
				local pos = getLocation("locBehemoth");
				addCameraPosition(0,"locBehemoth" , 90,20, 20);
				addCameraPosition(1000,"locBehemoth" , 90,20, 20);
				
				lookAtObject(tutorial_tmp.behemoth, tutorial_tmp.bguard1);
				addUnitCommand(tutorial_tmp.behemoth,"behemoth_fire_storm",tutorial_tmp.bguard1);
				addUnitCommand(tutorial_tmp.behemoth,"behemoth_fire_storm",tutorial_tmp.bguard1);
			</Effect>
		</Event>
		<Event trigger="behemoth_show_end" once="true">
			<Effect>
				setCutsceneMode(false);
				createDialogue();
				addAllPlayersToDialog();
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				
				speak("Tolec",_("Dieses Verdammte Ding. Ich hoffe die Wände halten."),"fear")
				speak("Derred",_("Verteilt schnell euren neuen Punkte und dann nichts wie weg von hier."),"fear");
			</Effect>
		</Event>
		
	</Region>
	
	<NPC refname="Derred">
		<Topic name="open_fooddoor" start_option="Futterklappe öffnen">
			<Condition>
				return (tutorial.phase == "findSecretDoor" and tutorial_tmp.fooddoor_open ~= true)
			</Condition>
			<Effect>
				local players = getPlayers();
				local i,player;
				local allattr = true;
				for i,player in ipairs(players) do
					if (getPlayerPrivateVar(player,"tutorial.phase") == "findSecretDoor" ) then
						if (get(player,"attribute_points") > 0) then
							allattr = false;
						end;
					end;
				end;
				
				if (allattr == false) then
					speak("Derred",_("Bitte verteilt zuerst eure Attributpunkte."));
					return;
				end;
				
				local door = getObjectByNameRef("slugFarmFoodDoor");
				addUnitCommand(tutorial_tmp.derred,"walk",door,2);
				tutorial_tmp.backroute =1;
			</Effect>
		</Topic>
	</NPC>
	
	<NPC refname="Tolec">
		<Topic name="open_fooddoor" start_option="Futterklappe öffnen">
			<Condition>
				return (tutorial.phase == "findSecretDoor" and tutorial_tmp.fooddoor_open ~= true)
			</Condition>
			<Effect>
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				setTopicBase("Derred");
				changeTopic("open_fooddoor");
			</Effect>
		</Topic>
	</NPC>
	
	<Region name="elCnlLobby">
		<Event trigger="command_complete" once="true">
			<Condition>
				return (trigger.unit == tutorial_tmp.derred and tutorial_tmp.backroute ==1 and tutorial_tmp.fooddoor_open ~= true)
			</Condition>
			<Effect>
				timedExecute("door_toggle('slugFarmFoodDoor')",1000);
				startTimer("go_backroute2",2000);
				tutorial_tmp.fooddoor_open = true;
			</Effect>
		</Event>
		<Event trigger="go_backroute2" once="true">
			<Effect>
				addUnitCommand(tutorial_tmp.derred,"walk","locBackroute2");
				addUnitCommand(tutorial_tmp.tolec,"walk","locBackroute1");
				addUnitCommand(tutorial_tmp.tolec,"walk","locBackroute2",1);
				tutorial_tmp.see_louse = false;
			</Effect>
		</Event>
		<Event trigger="player_moved" once="true">
			<Condition>
				if (tutorial_tmp.see_louse == false) then
					return (unitIsInArea(trigger.player,"dangerArea"));
				else
					return false;
				end;
			</Condition>
			<Effect>
				createMonsterGroup("tutorialMutantSlugs","locBackroute3",3);
				tutorial_tmp.slugs = getObjectsInArea("mutantSlugsArea","normal","monster");
				tutorial_tmp.slugnr = table.getn(tutorial_tmp.slugs);
				
				setCutsceneMode(true);				
				addCameraPosition(0,"locBackroute2" , -90,40, 20);
				addCameraPosition(1000,"locBackroute3" , -90,40, 20);
				startTimer("slugs2_scene",4000);
				
			</Effect>
		</Event>
		<Event trigger="slugs2_scene" once="true">
			<Effect>
				tutorial_tmp.slugs_out =0;
				local i
				for i=1,tutorial_tmp.slugnr do
					addUnitCommand(tutorial_tmp.slugs[i],"walk","locMutantSlugs");
				end;
				local tube = getObjectByNameRef("slugEscape");
				set(tube,"layer","nocollision");
			</Effect>
		</Event>
		
		<Event trigger="command_complete" >
			<Condition>
				return (get(trigger.unit,"subtype") == "fireSlug" or get(trigger.unit,"subtype") == "mutantSlug")
			</Condition>	
			<Effect>
				if (trigger.success ~= true) then
					addUnitCommand(tutorial_tmp.slugs[i],"walk","locMutantSlugs");
					return;
				end;
				
				tutorial_tmp.slugs_out = tutorial_tmp.slugs_out +1;
				deleteObject(trigger.unit);
				if (tutorial_tmp.slugs_out == tutorial_tmp.slugnr) then
					addCameraPosition(300,"locBackroute3" , -90,40, 20);
					addCameraPosition(2000,"locBackroute3" , -90,40, 20);
					addCameraPosition(1000,"locBackroute2" , -90,40, 20);
					startTimer("slugs2_dialog",4000);
					
					local tube = getObjectByNameRef("slugEscape");
					set(tube,"layer","normal");
				end;
			</Effect>
		</Event>
		<Event trigger="slugs2_dialog" >
			<Effect>
				createDialogue();
				setCutsceneMode(false);
				addAllPlayersToDialog();
				addStandardRoles();
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				
				speak("PL",_("Noch mehr von den Viechern?"),"unhappy");
				speak("Tolec",_("Uäks! Die scheinen irgendwie ausgebrochen zu sein. Hoffentlich vermehren die sich nicht in den Felsspalten."),"disgust");
				speak("mage",_("Habt ihr schon mal was von Sicherheitsvorkehrungen gehört?"),"grin");
				speak("Derred",_("Da hinten muss irgendwo die Geheimtür sein."),"thoughtful");
				speak("arcopt",_("Ihr wisst gar nicht sicher, ob sie da ist?"),"disgust");
				
				speak("Tolec",_("Ich verbringe meine Zeit nicht damit, durch Küchengänge zu kriechen, Verfluchter!"),"threaten");
				speak("priopt",_("Das heißt korrekt Gezeichneter. Du willst ja auch nicht Ernte genannt werden, oder?"),"angry");
				
				speak("Tolec",_("Schon gut, schon gut!"),"fear");
				
				executeInDialog("insertTrigger('walk_backroute3')");
			</Effect>
		</Event>
		
		<Event trigger="walk_backroute3" >
			<Effect>
				addUnitCommand(tutorial_tmp.derred,"walk","locBackroute3",1);
				addUnitCommand(tutorial_tmp.tolec,"walk","locBackroute3",1);
			</Effect>
		</Event>
		
		<Event trigger="player_moved" once="true">
			<Condition>
				if (tutorial.phase == "findSecretDoor") then
					return (unitIsInArea(trigger.player,"areaDanger"));
				else
					return false;
				end;
			</Condition>
			<Effect>
				setCutsceneMode(true);
				addCameraPosition(0,"locDanger2" , -90,70, 25);
				startTimer("mutant_slug_attack",1000);
				timedExecute("setCutsceneMode(false);",5000);
			</Effect>
		</Event>
		
		<Event trigger="mutant_slug_attack" >
			<Effect>
				tutorial_tmp.mutslug_timer = { 0,1300,2400,11000,13000,16000,17000, 20000};
				tutorial_tmp.mutslug_locs = {"locDanger1","locDanger4","locDanger3", "locDanger2", "locDanger5", "locDanger3", "locDanger2", "locDanger4"};
				tutorial_tmp.mutslug_type = {"mutantSlug","fireSlug","mutantSlug","fireSlug", "mutantSlug","fireSlug","mutantSlug","mutantSlug"};
				tutorial_tmp.mutslug_number = 8;
				tutorial_tmp.mutslug_killed = 0;
				tutorial_tmp.mutslug_attack = true;
				
				local i;
				for i=1,tutorial_tmp.mutslug_number do
				
					timedExecute("local slug = createObject('"..tutorial_tmp.mutslug_type[i].."','"..tutorial_tmp.mutslug_locs[i].."'); set(slug,'angle',180); set(slug,'layer','air');", tutorial_tmp.mutslug_timer[i]);
				end;
			</Effect>
		</Event>
		
		<Event trigger="unit_dead">
			<Condition>
				return (tutorial_tmp.mutslug_attack and (get(trigger.unit,"subtype") == "fireSlug" or get(trigger.unit,"subtype") == "mutantSlug"))
			</Condition>
			<Effect>
				tutorial_tmp.mutslug_killed = tutorial_tmp.mutslug_killed+1;
				
				if (tutorial_tmp.mutslug_killed == tutorial_tmp.mutslug_number) then
					tutorial_tmp.mutslugs_dead = true;
					insertTrigger("explain_skills");
				end;
			</Effect>	
		</Event>
		
		<Event trigger="explain_skills" once="true">
			<Effect>
				createDialogue();
				addAllPlayersToDialog();
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				
				local solo = (getPlayers()[2] == nil);
				addStandardRoles();
				
				speak("leader",_("Das sollte die letzte gewesen sein."),"amused");
				speak("Derred",_("Was für ein Gemetzel"),"disgust");
				speak("Tolec",_("Wirklich etwas stillos"),"thoughtful");
				speak("warrior",_("Suchst du Streit?!"),"threaten");
				speak("Tolec",_("Habt ihr eigentlich daran gedacht, eure mächtigen Fähigkeiten einzusetzen?"),"aloof");
				speak("Tolec",_("Der Lord Magister meinte, ihr könnt wesentlich mehr als nur stumpfsinnig auf die Gegner einzuschlagen."));
				speak("magopt",_("Tatsächlich?"),"surprised");
				
				tutorial_tmp.skill_continue = true;
				
				setTopicBase("Derred");
				addQuestion(_("Fähigkeiten erklären?"));
				addAnswer("Ja","explain_skills");
				addAnswer("Nein","explain_skills_no");
			</Effect>	
		</Event>
	</Region>
	
	<NPC refname="Derred">
		<Topic name="explain_skills" start_option="Fähigkeiten erklären">
			<Condition>
				return (tutorial.phase == "killlouses" or (tutorial.phase == "findSecretDoor" and tutorial_tmp.mutslugs_dead))
			</Condition>
			<Effect>
				speak("Derred",_("Mit der Taste 't' öffnet Ihr das Fähigkeitenfenster. Hier könnt Ihr eine Fähigkeit auswählen."));
				speak("Derred",_("Klickt einfach mit der Maustaste, mit der Ihr die Fähigkeit später einsetzen wollt, auf das Fähigkeitenbild."));
				speak("Derred",_("Die Fähigkeiten sind in zwei Gruppen unterteilt."));
				speak("Derred",_("Nachdem Ihr eine Fähigkeit eingesetzt habt, könnt Ihr alle Fähigkeiten dieser Gruppe für eine Weile nicht verwenden."));
				speak("Derred",_("Schaut auf das Bild in der unteren Leiste um zu erfahren, ob eine Fähigkeit einsatzbereit ist."));
				
				if (tutorial_tmp.skill_continue) then
					tutorial_tmp.skill_continue = nil;
					changeTopic("explain_skills_no");
				end;
			</Effect>
		</Topic>
		
		<Topic name="explain_skills_no">
				<Effect>
					local solo = (getPlayers()[2] == nil);
					if (tutorial_tmp.skill_continue) then
						if (solo) then
							speak("arcopt",_("Keine Sorge, ich bin schon fast wieder auf der vollen Höhe."),"sneer");
						else
							speak("arcopt",_("Keine Sorge, wir sind schon fast wieder auf der vollen Höhe."),"sneer");
						end
					end;
					
					speak("Tolec",_("Sehr gut. Die Geheimtür ist hier hinten."),"happy");
					speak("Derred",_("Warte mal. Am Ende hat der alte Knacker noch eine Falle angebaut."),"thoughtful");
					if (solo) then
						speak("Tolec",_("Stimmt auch wieder. Am besten, du machst das. Da kann wenigstens nichts schlimmes passieren."),"surprised") ;
					else
						speak("Tolec",_("Einfach auf die Tür klicken und sehen, was passiert."));
					end;
					speak("arcopt",_("Klar, schick den Gezeichneten vor."),"unhappy");
					
					local door = getObjectByNameRef("doorSecretLibrary");
					scriptobjectvar[door]["locked"] = false;
			   </Effect>
		</Topic>
	</NPC>
	
	<Region name="elCnlLobby">
		<Event trigger="object_use" once="true">
			<Condition>
				return (tutorial.phase == "findSecretDoor" and trigger.used_object == getObjectByNameRef("doorSecretLibrary") and tutorial_tmp.mutslugs_dead == true)
			</Condition>	
			<Effect>
				addUnitCommand(tutorial_tmp.derred,"walk","locBackroute4",1);
				addUnitCommand(tutorial_tmp.tolec,"walk","locBackroute4",1);
				addUnitCommand(tutorial_tmp.derred,"walk","locBackroute5",1);
				addUnitCommand(tutorial_tmp.tolec,"walk","locBackroute5",1);
			</Effect>
		</Event>
		
		<Event trigger="player_moved" once="true">
			<Condition>
				return (tutorial.phase == "findSecretDoor" and (unitIsInArea(trigger.player,"seeLouseArea")))
			</Condition>	
			<Effect>
				assembleParty("elCnlLobby","locPartyLib");
				tutorial_tmp.assemble = "louses";
			</Effect>
		</Event>
		
		<Event trigger="party_complete" once="true">
			<Condition>
				return (tutorial_tmp.assemble == "louses");
			</Condition>
			<Effect>
				tutorial_tmp.assemble = nil;
				moveObject(tutorial_tmp.tolec,"locBackroute5");
				moveObject(tutorial_tmp.derred, "locBackroute5");
				groupObjectsArc(getPlayers(),"locPartyLib","locBackroute5");
				groupObjectsArc({tutorial_tmp.tolec,tutorial_tmp.derred} ,"locBackroute5","locPartyLib",nil,30);
				
				createDialogue();
				addAllPlayersToDialog();
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				
				local solo = (getPlayers()[2] == nil);
				addStandardRoles();
				
				speak("Tolec",_("Gut,  Feuerwirbel ist nicht da."), "happy");
				speak("Derred",_("Woran forscht der hier eigentlich die ganze Zeit? Die Blumen da können doch nicht im Sinne des Konzils und Akerans sein."),"thoughtful");
				speak("magopt",_("Ich bin sicher, dahinter steckt mehr, als das Auge sieht. Ein Apfelelementar zum Beispiel."),"sneer");
				speak("Derred",_("Zuzutrauen wäre es ihm jedenfalls."),"amused");
				speak("Tolec",_("Spaß bei Seite! Wir müssen weiter. "));
				
				if (solo) then
					speak("leader",_("Bei den ganzen Mistviechern, die hier frei in der Gegend rumspringen glaube ich fast, die wollen mich nur als Kammerjäger..."),"unhappy");
				else
					speak("leader",_("Bei den ganzen Mistviechern, die hier frei in der Gegend rumspringen glaube ich fast, die wollen uns nur als Kammerjäger..."),"unhappy");
				end;
				
				executeInDialog("insertTrigger('tolec_open_libdoor')");
			</Effect>	
		</Event>
		
		<Event trigger="tolec_open_libdoor" once="true">
			<Effect>
				local door = getObjectByNameRef("doorLibrary");
				addCameraPosition(0,"locBackroute5" , -90,70, 20);
				setCutsceneMode(true);
				addUnitCommand(tutorial_tmp.tolec,"walk",door,1);
				
				tutorial_tmp.tolec_libdoor = true;
			</Effect>	
		</Event>
		
		<Event trigger="command_complete" once="true">
			<Condition>
				return (trigger.unit ==  tutorial_tmp.tolec
				and tutorial_tmp.tolec_libdoor == true);
			</Condition>	
			<Effect>
				local door = getObjectByNameRef("doorLibrary");
				door_toggle(door);
				timedExecute('addUnitCommand(tutorial_tmp.tolec,"walk","locBackroute6",1);',1000);
				startTimer("behemoth_attack_4",2000);
			</Effect>	
		</Event>
		
		<Event trigger="behemoth_attack_4" once="true">
			<Effect>
				addCameraPosition(1000,"locDoorGuardNorth" , 45,45, 25);
				local door = getObjectByNameRef("doorBehemothNorth");
				--moveObject(tutorial_tmp.behemoth,"locBehemothRaid");
				addUnitCommand(tutorial_tmp.behemoth,"attack",door);
				tutorial_tmp.behemoth_door_attack = true;
			</Effect>	
		</Event>
		
		<Event trigger="command_complete" once="true">
			<Condition>
				return (trigger.unit == tutorial_tmp.behemoth 
				and tutorial_tmp.behemoth_door_attack == true);
			</Condition>	
			<Effect>
				tutorial_tmp.behemoth_door_attack = false;
				local door = getObjectByNameRef("doorBehemothNorth");
				deleteObject(door);
				addUnitCommand(tutorial_tmp.bguard1,"walk","locLouses");
				unitSpeak(tutorial_tmp.bguard1,_("Hilfe!"),"fear");
				
				addUnitCommand(tutorial_tmp.behemoth,"fire_ball",tutorial_tmp.bguard1);
			</Effect>	
		</Event>
		
		<Event trigger="unit_dead" once="true">
			<Condition>
				return (trigger.unit== tutorial_tmp.bguard1)
			</Condition>
			<Effect>
				local pos = get(tutorial_tmp.behemoth,"position");
				tutorial_tmp.lousepos = { pos[1],pos[2]-6 };
				tutorial_tmp.louse={};
				tutorial_tmp.louse_count =0;
				insertTrigger("slaves_flee");
			</Effect>	
		</Event>
		
		<Event trigger="slaves_flee"  once="true">
			<Effect>
				timedExecute('addCameraPosition(500,"locSlave6" , 0,45, 25)',1000);
				addUnitCommand(tutorial_tmp.slave1,"walk","locWay3");
				addUnitCommand(tutorial_tmp.slave2,"walk","locWay3");
				addUnitCommand(tutorial_tmp.slave3,"walk","locWay3");
				unitSpeak(tutorial_tmp.slave3,_("Hilfe!"),"fear",2000);
				tutorial_tmp.delslaves = true;
				
				timedExecute('addCameraPosition(500,"locDoorGuardNorth" , 45,45, 25);',4000);
				startTimer("create_louse",5000);
			</Effect>	
		</Event>
		
		<Event trigger="unit_moved" >
			<Condition>
				return (get(trigger.unit,"subtype") == "slave_miner" and tutorial_tmp.delslaves==true and unitIsInArea(trigger.unit,"fleeingSlaves"))
			</Condition>	
			<Effect>
				deleteObject(trigger.unit);
			</Effect>
		</Event>
		
		<Event trigger="create_louse">
			<Effect>
				if (tutorial_tmp.louse_count ~= 4) then
					tutorial_tmp.louse_count = tutorial_tmp.louse_count +1;
					tutorial_tmp.louse[tutorial_tmp.louse_count] = createObject("fireLouse",tutorial_tmp.lousepos);
					addUnitCommand(tutorial_tmp.louse[tutorial_tmp.louse_count], "walk","locLouses",2);
					startTimer("create_louse",2500+math.random(1500));
				else
					tutorial_tmp.louses = 0;
					timedExecute('addCameraPosition(1000,"locBackroute5" , -90,70, 20)',1000);
					startTimer("tolec_retreat",2000);
				end;
			</Effect>	
		</Event>
		
		<Event trigger="tolec_retreat"  once="true">
			<Effect>
				unitSpeak(tutorial_tmp.tolec,_("Ups"));
				addUnitCommand(tutorial_tmp.tolec,"walk","locBackroute5");
				tutorial_tmp.tolec_retreat = true;
			</Effect>	
		</Event>
		
		<Event trigger="command_complete" once="true">
			<Condition>
				return (trigger.unit == tutorial_tmp.tolec 
				and tutorial_tmp.tolec_retreat == true);
			</Condition>	
			<Effect>
				tutorial_tmp.tolec_retreat = nil;
				local door = getObjectByNameRef("doorLibrary");
				lookAtObject(tutorial_tmp.tolec,door);
				door_toggle(door);
				startTimer("louse_dialog",2000);
			</Effect>	
		</Event>
		
		<Event trigger="louse_dialog" once="true">
			<Effect>
				setCutsceneMode(false);
				groupObjectsArc(getPlayers(),"locPartyLib","locBackroute5");
				groupObjectsArc({tutorial_tmp.tolec,tutorial_tmp.derred} ,"locBackroute5","locPartyLib",nil,30);
				
				createDialogue();
				addAllPlayersToDialog();
				local solo = (getPlayers()[2] == nil);
				addStandardRoles();
				
				addSpeaker(tutorial_tmp.tolec,"Tolec",true);
				addSpeaker(tutorial_tmp.derred,"Derred",true);
				
				speak("Derred",_("Was für ein Tag. Wusstest du, dass das Ding auch noch kleine Monster spucken kann?"),"unhappy");
				speak("Tolec",_("Darüber hat der Lord Magister nichts gesagt..."),"thoughtful");
				speak("magopt",_("Etwas, das nicht im Buch des allwissenden Luftpfote geschrieben steht?"),"sneer");
				speak("Tolec",_("Windklaue, du Häretiker!"),"threaten");
				if (solo) then
					speak("Derred",_("Einen Verfluchten freut das sicher noch, wenn er alle Nase lang was zum Töten hat."),"disgust");
					speak("any",_("ich bin ein Gezeichneter! Das ist viel schlimmer als ein Fluch."),"threaten");
					speak("Tolec",_("Der mächtige Akeran hat dich wahrlich schlimm gestraft."),"thoughtful");
					speak("PL",_("Verschone mich mit deinem Elementaristengelaber und gib den Weg frei!"),"angry");
					speak("warrior",_("Ich bin wohl wirklich der Kammerjäger."),"bored");
				else
					speak("Derred",_("Die Verfluchten freut das sicher noch, wenn sie alle Nase lang was zum Töten haben."),"disgust");
					speak("any",_("Wir sind Gezeichnete! Das ist viel schlimmer als ein Fluch."),"threaten");
					speak("Tolec",_("Der mächtige Akeran hat sie wahrlich schlimm gestraft."),"thoughtful");
					speak("PL",_("Verschone uns mit deinem Elementaristengelaber und gib den Weg frei!"),"angry");
					speak("warrior",_("Wir sind wohl wirklich die Kammerjäger."),"bored");
				end;
				
				tutorial.phase = "killlouses";
				tutorial.phasenr = 4;
			</Effect>	
		</Event>
	
		<Event trigger="unit_dead">
			<Condition>
				return (tutorial.phase == "killlouses" and get(trigger.unit,"subtype") == "fireLouse")
			</Condition>
			<Effect>
				tutorial_tmp.louses = tutorial_tmp.louses +1;
				if (tutorial_tmp.louses == tutorial_tmp.louse_count) then
					local door = getObjectByNameRef("doorLibrary");
					door_setopen(door,true);
					
					addUnitCommand(tutorial_tmp.derred,"walk","locBackroute6",4);
					addUnitCommand(tutorial_tmp.tolec,"walk","locBackroute6",4);
					tutorial_tmp.door = getObjectByNameRef("doorScene1");
					addUnitCommand(tutorial_tmp.derred,"walk",tutorial_tmp.door,1);
					addUnitCommand(tutorial_tmp.tolec,"walk",tutorial_tmp.door,1);
					
					tutorial.finished = true;
				end;
			</Effect>
		</Event>
		
		
	</Region>
	
	
</Quest>
	