<Quest name="Der Goblinvernichter" table_name="goblins">
	
	<Init>
		goblins.nr =0;
	</Init>
	
	<Description>
		if (goblins.finished) then
			return _("Quest finished");
		end
		if (goblins.nr >=10) then
			return _("killed enough goblins");
		end
		nr = (10-goblins.nr)
		return gettext("'Kill '..nr..' more Goblins'");
	</Description>
	
	<NPC refname="peasant">
		<Topic name="goblins" start_option="Goblins">
			<Condition>
				return (not goblins.finished)
			</Condition>
			<Effect>
				if (goblins.started) then
					if (goblins.nr >=10) then
						speak('player', _("I have killed them"))
						speak('peasant',_("you are soo great"));
						changeTopic('finish_gob_quest');
					else
						speak('peasant',_("Go and kill some more..."));
					end
				else
					speak('peasant',_("There are some stupid goblins around"));
					speak('peasant',_("If you kill 10 of them you get a reward"));
					speak('peasant',_("Interested?"));
					addQuestion(_("Accept Quest?"));
					addAnswer(_("Yes"),'start_gob_quest'); 
					addAnswer(_("No"),'end');
				end
			</Effect>
		</Topic>
		
		<Topic name="goblins_reward" start_option="Goblins (Belohnung)">
			<Condition>
				if (goblins.finished == false) then return false end;
				return (getPlayerPrivateVar(getSpeaker('player'),"goblins.reward2") ~= true)
			</Condition>
			<Effect>
				speak('peasant',_("A second reward ?"));
				speak('player', _("Yeah"),1000)
				speak('peasant',_("I give you a goblin club"));
				setPlayerPrivateVar(getSpeaker('player'),"goblins.reward2",true);
				changeTopic('goblins_reward2');
			</Effect>
		</Topic>
		
		
		<Topic name="start_gob_quest" >
			<Effect>
				speak('player', _("Nearly done"),1000)
				speak('peasant',_("Have fun"));
				goblins.started = true;
				goblins.nr =0;
			</Effect>	
		</Topic>
		
		<Topic name="finish_gob_quest" >
			<Effect>
				
				goblins.finished = true;
				local players = getPlayers();
				local i,player;
				for i,player in ipairs(players) do
					if (getPlayerPrivateVar(player,"goblins.reward") ~= true) then
						setPlayerPrivateVar(player,"goblins.reward",true);
						setObjectValue(player,"attribute_points", getObjectValue(player,"attribute_points") +5);
					end;
				end;	
			</Effect>
		</Topic>
		
		<Topic name="goblins_reward2" >
			<Effect>
				local npc = getSpeaker('peasant');
				dropItem("goblin_hmr", getPosition(npc),500);
			</Effect>
		</Topic>
	</NPC>
	
	<Region name="region1">
		<Event trigger ="unit_die">
			<Condition>
				if (not goblins.started or goblins.nr >= 10) then
					return false;
				end
				return (getType(trigger.unit) == "goblin");
			</Condition>
			<Effect>
				goblins.nr = goblins.nr +1;
			</Effect>
		</Event>
	</Region>
	
</Quest>