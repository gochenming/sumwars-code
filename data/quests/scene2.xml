<Quest name="Scene2" table_name="scene2">
	
	<Init>
		local a = 2
	</Init>
	
	<Description>
		if (scene2.finished) then
			return _("Quest finished")
		else
			return _("Quest description")
		end
	</Description>
	
	<NPC refname="Soren Windclaw">
		<!--
		<Topic name="scene2" start_option="Defend Dwarfenfroward">
			<Condition>
				if (scene2.finished ~= true and scene2.freed ~= true) then
					return true
				else
					return false
				end
			</Condition>
			<Effect>
				insertTrigger("start_scene2")
			</Effect>
		</Topic>
		-->
		<Topic name="scene2_dialogue">
			<Effect>
				addCameraPosition(0,get(getRole("PL"),"position"),20,40,20);
				addCameraPosition(20000,get(getRole("PL"),"position"),220,60,30);

				speak("PL",_("Can we blind this crystal somehow?"),1500);
				if (getRole("MAG") ~= nil) then
					speak("MAG",_("But of course."),1000);
					speak("MAG",_("I know this nice little trick."),1500);
				elseif (getRole("PRI") ~= nil) then
					speak("PRI",_("But of course."),1000);
					speak("PRI",_("I know this nice little trick."),1500);
				else
					speak("ANY",_("But of course."),1000);
					speak("ANY",_("I know this nice little trick."),1500);
				end;

				-- (beginnt den Kristall zu verzaubern)

				speak("SW",_("Don't you dare to, or"),1000);
				jumpTopic("remove_soren");
				if (getRole("MAG") ~= nil) then
					speak("MAG",_("Well, it's done."),1000);
				elseif (getRole("PRI") ~= nil) then
					speak("PRI",_("Well, it's done."),1000);
				else
					speak("ANY",_("Well, it's done."),1000);
				end;
				speak("PL",_("And now he can't hear us anymore?"),1300);
				if (getRole("MAG") ~= nil) then
					speak("MAG",_("Only if we want to."),1000);
					speak("MAG",_("But he can still annoy us."),1200);
					speak("MAG",_("We will defenitly notice if he has something to tell to us."),2000);
				elseif (getRole("PRI") ~= nil) then
					speak("PRI",_("Only if we want to."),1000);
					speak("PRI",_("But he can still annoy us."),1200);
					speak("PRI",_("We will defenitly notice if he has something to tell to us."),2000);
				else
					speak("ANY",_("Only if we want to."),1000);
					speak("ANY",_("But he can still annoy us."),1200);
					speak("ANY",_("We will defenitly notice if he has something to tell to us."),2000);
				end;
				speak("PL",_("Very good."),1000);
				speak("PL",_("What do you think about all this?"),1300);
				speak("ANYast",_("Did I get this right?"),1200);
				speak("ANYast",_("Has he really the power to release us of Harad's Curse?"),1800);
				speak("WAR",_("He said that, but I never heard before that someone took something out of hell."),2200);
				speak("MAG",_("That thing was real, no doubt about it."),1400);
				speak("MAG",_("The sight alone gave me goose bumps."),1300);
				speak("WAR",_("You nearly fainted."),1000);
				speak("PRI",_("Freedom."),1000);
				speak("PRI",_("I don't even have memorys of it..."),1200);
				speak("ANYast",_("Still, it's unlikely that he will keep his promise."),1500);
				speak("ANYast",_("Even if he has the power to do it we're to valuable to his ends."),1900);
				speak("ANYast",_("We are truely branded."),1200);
				speak("WAR",_("If there's even the slightest chance I'm willing to try."),1500);
				speak("MAG",_("If stupidity had a weight you'd be unable to move."),1500);
				speak("WAR",_("If arrogance had a smell you'd suffocate instantly"),1500);
				speak("PL",_("Very well than. Let's vote about our course of action."),1600);

				-- => Den Anweisungen der Gilde folgen?

				addQuestion(_("Follow the guilds orders?"));
				addAnswer(_("Yes"),"follow_instructions");
				addAnswer(_("No"),"dont_follow_instructions");
			</Effect>
		</Topic>
		
		<Topic name="remove_soren">
			<Effect>
				deleteObject(scene2_tmp.soren_windclaw_crystal);
			</Effect>
		</Topic>
				
		<Topic name="follow_instructions">
			<Effect>
				speak("PL",_("Than it's decided. We'll raise hell if they don't keep their word."),2000);
				
				-- weiter in das Soeldnerlager.
				print("test1");
				changeTopic("end_cutscene2");
			</Effect>
		</Topic>
		
		<Topic name="dont_follow_instructions">
			<Effect>
				speak("PL",_("This hole thing is really too precarious."),1500);
				speak("PL",_("We can't afford open resistance though, "),1500);
				speak("PL",_("so we'll grind and bear it for the time being."),1500);
				speak("PL",_("Let's win their trust."),1300);
				
				-- weiter in das Soeldnerlager.
				
				changeTopic("end_cutscene2");
			</Effect>
		</Topic>
		
		<Topic name="end_cutscene2">
			<Effect>
				print("test2");
				scene2.scene2 = true;
				setCutsceneMode(false);
			</Effect>
		</Topic>
	</NPC>
	
	
	<Region name="medBackalley">
		<Event trigger="create_region" once="true">
			<Effect>
				addArea("medBackalleyEntrySouthArea","circle","entry_south",5);
			</Effect>
		</Event>
		
		<Event trigger="player_moved" once="true">
			<Condition>
				if (fortify_dwarfenfroward.scene1 == true and scene2.scene2 ~= true and getPlayers()[2] ~= nil) then
					return (unitIsInArea(trigger.player,"medBackalleyEntrySouthArea"));
				else
					return false;
				end;
			</Condition>
			<Effect>
				scene2_tmp.soren_windclaw_crystal = createObject("peasant", "entry_south");
				setRefName(scene2_tmp.soren_windclaw_crystal, "Soren Windclaw");
				createDialogue();
				addSpeaker(scene2_tmp.soren_windclaw_crystal,"SW");
				addSpeaker(trigger.player,"Player");
				addStandardSpeakers("medBackalley","entry_south");
				setCutsceneMode(true);
				setTopicBase("Soren Windclaw");
				changeTopic("scene2_dialogue");
			</Effect>
		</Event>
	</Region>
	
</Quest>

