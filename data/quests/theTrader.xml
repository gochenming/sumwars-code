<Quest name="The Trader" table_name="theTrader">
	<Description>
		if (fortify_dwall.finished) then
			return _("Quest finished")
		else
			return _("Ein seltsamer Haendler hat angeboten, Leere Schriftrollen zu verkaufen.")
		end
	</Description>
	
	<Region name="elCnlLobby">
		<Event trigger="elemental_end" once="true">
			<Effect>
				if(theTrader.intro ~= "true") then
					theTrader.intro = "false";
				end;
			</Effect>
		</Event>
	</Region>
	
	<Region name="medMercCamp">
		<Event trigger="create_region" once = "true">
			<Effect>
				if (theTrader.intro ~= "true") then
					theTrader_tmp.theTrader = createObject("theTrader", "locTheTraderIntro");
					setRefName(theTrader_tmp.theTrader, "The Trader");
					set(theTrader_tmp.theTrader,"angle",120);
				else
					theTrader_tmp.theTrader = createObject("theTrader", "locTheTrader");
					setRefName(theTrader_tmp.theTrader, "The Trader");
					set(theTrader_tmp.theTrader,"angle",180);
				end;
			</Effect>
		</Event>
		
		<Event trigger="enter_region" once = "true">
			<Effect>
				if (theTrader.intro ~= "true") then
					startTimer("start_theTraderIntro",1000);
				end;
			</Effect>
		</Event>
		
		<Event trigger="start_theTraderIntro" once = "true">
			<Effect>
				setCutsceneMode(true);
				addCameraPosition(0,"entry_south",-90,50, 20);
				assembleParty("medMercCamp","entry_south");
				theTrader_tmp.startTalk = true;
			</Effect>
		</Event>
		
		<Event trigger="party_complete" once="true">
			<Condition>
				return (theTrader_tmp.startTalk == true);
			</Condition>
			<Effect>
				createDialogue();
				addAllPlayersToDialog();
				addStandardRoles();

				addSpeaker(theTrader_tmp.theTrader,"theTrader");
				
				--greeting by composure of the group
				if (solo() and femaleOnly()) then
					speak("theTrader",_("Einen Augenblick, ehrenwerte Dame."));
					executeInDialog("addUnitCommand(theTrader_tmp.theTrader,'talk')");
				elseif(solo() and maleOnly()) then
					speak("theTrader",_("Einen Augenblick, ehrenwerter Herr."));
				elseif(femaleOnly()) then
					speak("theTrader",_("Einen Augenblick, ehrenwerte Damen."));
				elseif(maleOnly()) then
					speak("theTrader",_("Einen Augenblick, ehrenwerter Herr."));
				else
					speak("theTrader",_("Einen Augenblick, ehrenwerte Herrschaften."));
				end;

				speak("PL", _("Was ist denn jetzt schon wieder?"),"unhappy");
				
				if(solo()) then
					speak("theTrader", _("Mir scheint, Ihr steckt in Harads schwarzen Klauen."),"happy");
				else
					speak("theTrader", _("Mir will scheinen, Ihr steckt in Harads schwarzen Klauen."),"happy");
				end;

				speak("PL", _("Was willst du damit sagen?"),"threaten");
				speak("theTrader", _("Nun, ich will damit sagen, dass ich meine Dienste anbieten möchte."));
				
				speak("arcopt", _("Ihr seid Händler?"),"thoughtful.");
				speak("theTrader", _("In der Tat."),"amused");
				speak("theTrader", _("Doch leider setzte ich auf den falschen Zweig und stehe nun mit einem größeren Kontingent Leerer Schriftrollen da."),"sad");
				if(not solo()) then
					speak("waropt", _("Was wollen wir denn mit leeren Schriftrollen?"),"unhappy");
					if(getSpeaker("waropt") ~= getSpeaker("magopt")) then
						speak("magopt", _("Hast du die Großbuchstaben nicht gehört?"),"sneer");
					end;
				end;
				speak("magopt", _("Was sind das für Rollen?"),"normal");
				
				-- if (get(getSpeaker("magopt","gender")=="male") then
					speak("theTrader", _("Ihr seid ein Mensch von Verstand!"),"excited");
				--end;
				speak("theTrader", _("Eine Leere Schriftrolle ist zu meinem großen Bedauern nur zu einem in der Lage:"),"thoughtful");
				speak("theTrader", _("Einen Weg durch Harads Schwarzen Abgrund schaffen."),"excited");
				speak("theTrader", _("Und dann auch noch nur zu einer Stelle großer magischer Konzentration wie dem dicken Wegeschrein da hinten."),"sad");
				executeInDialog("addCameraPosition(1000,'WaypointLoc', -90,50, 20)");
				--Kamera bewegen
				speak("theTrader", _("Die Macht erschöpft sich außerdem recht schnell und ist auf eine Person beschränkt."),"thougtful");
				executeInDialog("addCameraPosition(1000,'entry_south', -90,50, 20)");
				speak("theTrader", _("Aber Goblins und ähnliches Gekreuch haben in letzter Zeit allerhand gestohlen."),"normal");
				speak("theTrader", _("Es mag Euch gelegen kommen, einen kurzen Abstecher zu einem gut sortierten Händler zu unternehmen."),"grin");
				speak("PL", _("Nämlich Euch?"),"sneer");
				speak("theTrader", _("Zu meinem Bedauern nein."),"sad");
				speak("theTrader", _("Wie bereits berichtet habe ich mich mit den Leeren Schriftrollen übernommen und derzeit kein freies Kapital."));
				speak("theTrader", _("Ich fürchte, ich kann euch nur unzureichende Mengen an Gold für eure Waren bieten."));
				speak("theTrader", _("Aber ich kann euch noch sehr lange  versorgen, das verspreche ich Euch."),"happy");
				speak("theTrader", _("Schon deswegen, weil Kundschaft in diesen Breiten rar gesät ist."),"normal");
				speak("priopt", _("Das ist sie überall."), "normal");
				speak("theTrader", _("Und ohne Euch zu nahe zu treten: Das ist auch gut so."),"thoughtful");
				speak("theTrader", _("Nicht viele Gezeichnete hätten mir so zugehört wie Ihr."),"normal");
				speak("theTrader", _("Lasst mich Euch eine Leere Schriftrolle als Werbegeschenk überreichen."),"happy");
				speak("theTrader", _("Beehrt mich bald wieder."));
				theTrader_tmp.walkFromIntro = true;
				theTrader.intro="true";
				executeInDialog("addUnitCommand(theTrader_tmp.theTrader,'walk','locTheTrader')");			
				speak("arcopt", _("Komischer Kauz."));
				executeInDialog("setCutsceneMode(false)");
				local players = getPlayers();
				local i,player;
				for i,player in ipairs(players) do
					createItem("town_portal")
					insertPlayerItem(player,false);
				end;
			</Effect>
		</Event>
		
		<Event trigger="command_complete">
			<Condition>
				if((trigger.unit==theTrader_tmp.theTrader)and(theTrader_tmp.walkFromIntro==true))then
					return true;
				else
					return false;
				end;
			</Condition>
			<Effect>
					set(theTrader_tmp.theTrader,"angle",180);
			</Effect>
		</Event>
	</Region>

</Quest>